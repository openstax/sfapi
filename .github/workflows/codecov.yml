name: Tests

  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

jobs:
    tests:
        runs-on: ubuntu-latest
        timeout-minutes: 30

        steps:
        - name: Checkout code
            uses: actions/checkout@v2

        - name: Set up Python
            uses: actions/setup-python@v2


        - name: Install dependencies
            run: |
            python -m pip install --upgrade pip
            pip install -r requirements/test.txt

        - name: Run tests
            run: python manage.py test --settings sfapi.settings.test

        - name: Upload coverage reports to Codecov
          uses: codecov/codecov-action@v4.0.1
          with:
            token: ${{ secrets.CODECOV_TOKEN }}
            slug: openstax/sfapi
